<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Editor de Currículum Profesional</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<style>
:root {
    --primary-color: #0d47a1;
    --secondary-color: #f5f5f5;
    --background-color: #eef2f5;
    --font-color: #212121;
    --white-color: #ffffff;
    --border-color: #b0bec5;
    --accent-color: #1565c0;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
    font-family: 'Roboto', Arial, sans-serif;
    background-color: var(--background-color);
    color: var(--font-color);
    line-height: 1.6;
    display: flex;
    justify-content: center;
    padding: 25px;
}

.container { max-width: 900px; width: 100%; }

#download-pdf-btn {
    display: block;
    margin: 0 auto 25px auto;
    padding: 12px 28px;
    background-color: var(--primary-color);
    color: var(--white-color);
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 500;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: background-color 0.3s, box-shadow 0.3s;
}
#download-pdf-btn:hover { background-color: var(--accent-color); box-shadow: 0 4px 8px rgba(0,0,0,0.15); }

#resume {
    display: flex;
    width: 794px;
    min-height: 1123px;
    background: var(--white-color);
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    margin: 0 auto;
    border-radius: 6px;
    overflow: hidden;
    border: 1px solid #ddd;
}

[contenteditable="true"] {
    cursor: text;
    padding: 2px 4px;
    border-radius: 4px;
    transition: background-color 0.3s, box-shadow 0.3s;
}
[contenteditable="true"]:hover,[contenteditable="true"]:focus {
    background-color: #e3f2fd;
    outline: 1px solid var(--accent-color);
    box-shadow: 0 0 0 3px rgba(21,101,192,0.1);
}

.sidebar { flex: 0.8; background: var(--secondary-color); color: var(--font-color); padding: 40px 25px; }
.main-content { flex: 2.2; padding: 40px 35px; }
.section { margin-bottom: 28px; }
.section-title {
    text-transform: uppercase;
    font-weight: 700;
    font-size: 16px;
    letter-spacing: 1px;
    margin-bottom: 16px;
    padding-bottom: 8px;
    border-bottom: 2px solid var(--primary-color);
    color: var(--primary-color);
}
.header { margin-bottom: 30px; }
.header h1 { font-size: 40px; font-weight: 700; color: var(--primary-color); margin-bottom: 8px; letter-spacing: 1.5px; }
#puesto-actual { font-size: 18px; font-weight: 400; color: var(--font-color); }
p, li { font-size: 14px; color: var(--font-color); }
.job, .course { margin-bottom: 20px; }
h3 { font-size: 18px; font-weight: 500; color: var(--accent-color); margin-bottom: 2px; }
.job-company-duration,.course-institution { font-size: 14px; font-style: italic; margin-bottom: 8px; color: #546e7a; }
ul { list-style-type: disc; list-style-position: outside; padding-left: 20px; }
li { margin-bottom: 6px; }
#aptitudes h4 { color: var(--font-color); font-size: 15px; font-weight: 700; margin-top: 15px; margin-bottom: 8px; }
#aptitudes ul { list-style-type: none; padding-left: 0; }
#aptitudes ul li { font-size: 14px; color: var(--font-color); }
</style>
</head>
<body>
<div class="container">
    <button id="download-pdf-btn">Descargar como PDF</button>
    <div id="resume">
        <aside class="sidebar">
            <div class="contact-info section">
                <h2 class="section-title">Contacto</h2>
                <p id="telefono" contenteditable="true"></p>
                <p id="email" contenteditable="true"></p>
            </div>
            <div id="aptitudes" class="section">
                <h2 class="section-title">Aptitudes</h2>
            </div>
        </aside>
        <main class="main-content">
            <header class="header">
                <h1 id="nombre" contenteditable="true"></h1>
                <p id="puesto-actual" contenteditable="true">Técnico especialista FP 2 Metal / Técnico de SAT</p>
            </header>
            <section id="resumen-section" class="section">
                <h2 class="section-title">Resumen Profesional</h2>
                <div id="resumen"></div>
            </section>
            <section id="experiencia-section" class="section">
                <h2 class="section-title">Experiencia Laboral</h2>
                <div id="experiencia"></div>
            </section>
            <section id="formacion-section" class="section">
                <h2 class="section-title">Formación</h2>
                <div id="formacion"></div>
            </section>
        </main>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const nombreEl = document.getElementById('nombre');
    const puestoActualEl = document.getElementById('puesto-actual');
    const telefonoEl = document.getElementById('telefono');
    const emailEl = document.getElementById('email');
    const resumenContainer = document.getElementById('resumen');
    const experienciaContainer = document.getElementById('experiencia');
    const formacionContainer = document.getElementById('formacion');
    const aptitudesContainer = document.getElementById('aptitudes');

    async function loadResumeData() {
        try {
            const response = await fetch('cv.json');
            if (!response.ok) throw new Error(`Error HTTP: ${response.status}`);
            const data = await response.json();
            populateResume(data);
            makeEditable();
        } catch (error) {
            console.error("No se pudo cargar el archivo cv.json:", error);
            alert("Error al cargar cv.json.");
        }
    }

    function populateResume(data) {
        nombreEl.textContent = data.nombre;
        puestoActualEl.textContent = data.puesto_actual || 'Tu Puesto Actual';
        telefonoEl.textContent = data.contacto.telefono;
        emailEl.textContent = data.contacto.email;
        resumenContainer.innerHTML = data.resumen.map(p => `<p>${p}</p>`).join('');
        experienciaContainer.innerHTML = data.experiencia.map(job => `
            <div class="job">
                <h3>${job.puesto}</h3>
                <p class="job-company-duration">${job.empresa} | ${job.duracion}</p>
                <ul>${job.responsabilidades.map(r => `<li>${r}</li>`).join('')}</ul>
            </div>
        `).join('');
        formacionContainer.innerHTML = data.formacion.map(course => `
            <div class="course">
                <h3>${course.titulo}</h3>
                <p class="course-institution">${course.institucion} | ${course.anio}</p>
            </div>
        `).join('');
        aptitudesContainer.innerHTML = '<h2 class="section-title">Aptitudes</h2>' + data.aptitudes.map(cat => `
            <div class="skill-category">
                <h4>${cat.categoria}</h4>
                <ul>${cat.items.map(i => `<li>${i}</li>`).join('')}</ul>
            </div>
        `).join('');
    }

    function makeEditable() {
        document.querySelectorAll('#resume h1, #resume h3, #resume h4, #resume p, #resume li').forEach(el => el.setAttribute('contenteditable','true'));
    }

    document.getElementById('download-pdf-btn').addEventListener('click', () => {
        if (document.activeElement) document.activeElement.blur();
        const resumeElement = document.getElementById("resume");

        html2canvas(resumeElement, { scale: 3, useCORS: true }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const { jsPDF } = window.jspdf;
            
            // PDF con tamaño dinámico según contenido
            const pdf = new jsPDF('p', 'pt', [canvas.width, canvas.height]);
            pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
            pdf.save("curriculum-profesional.pdf");
        });
    });

    loadResumeData();
});
</script>
</body>
</html>
